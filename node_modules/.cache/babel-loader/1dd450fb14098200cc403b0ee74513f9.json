{"ast":null,"code":"import _defineProperty from \"C:\\\\Users\\\\raheem.azeezat\\\\Desktop\\\\e-voting\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"C:\\\\Users\\\\raheem.azeezat\\\\Desktop\\\\e-voting\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\raheem.azeezat\\\\Desktop\\\\e-voting\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"C:\\\\Users\\\\raheem.azeezat\\\\Desktop\\\\e-voting\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"C:\\\\Users\\\\raheem.azeezat\\\\Desktop\\\\e-voting\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"C:\\\\Users\\\\raheem.azeezat\\\\Desktop\\\\e-voting\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"C:\\\\Users\\\\raheem.azeezat\\\\Desktop\\\\e-voting\\\\src\\\\Register.js\";\nimport React, { Component } from 'react';\nimport { Button, Form, Input, Select } from 'semantic-ui-react';\nimport { withRouter } from 'react-router-dom';\nimport firebaseConf from './Components/Firebase';\nimport { Offline } from 'react-detect-offline';\nimport emailjs from 'emailjs-com';\nvar options = [{\n  key: '1',\n  text: 'JSS1/YEAR 7',\n  value: 'JSS1/YEAR 7'\n}, {\n  key: '2',\n  text: 'JSS2/YEAR 8',\n  value: 'JSS2/YEAR 8'\n}, {\n  key: '3',\n  text: 'JSS3/YEAR 9',\n  value: 'JSS3/YEAR 9'\n}, {\n  key: '4',\n  text: 'SS1/YEAR 10',\n  value: 'SS1/YEAR 10'\n}, {\n  key: '5',\n  text: 'SS2/FORM 11',\n  value: 'SS2/FORM 11'\n}, {\n  key: '6',\n  text: 'SS3/FORM 12',\n  value: 'SS3/FORM 12'\n}, {\n  key: 'TS',\n  text: 'TEACHING STAFF',\n  value: 'TEACHING STAFF'\n}, {\n  key: 'NTS',\n  text: 'NON-TEACHING STAFF',\n  value: 'NON-TEACHING STAFF'\n}, {\n  key: 'O',\n  text: 'OTHERS',\n  value: 'OTHERS'\n}];\n\nvar FormExampleFieldControl =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(FormExampleFieldControl, _Component);\n\n  function FormExampleFieldControl() {\n    var _this;\n\n    _classCallCheck(this, FormExampleFieldControl);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(FormExampleFieldControl).call(this));\n\n    _this.handleChange = function (e) {\n      _this.setState(_defineProperty({}, e.target.name, e.target.value));\n    };\n\n    _this.handleOptionSelect = function (e, _ref) {\n      var name = _ref.name,\n          value = _ref.value;\n\n      _this.setState(_defineProperty({}, name, value));\n    };\n\n    _this.handleSubmit = function (e) {\n      e.preventDefault();\n\n      _this.setState({\n        isLoading: true\n      });\n\n      var _this$state = _this.state,\n          uniqueIdentity = _this$state.uniqueIdentity,\n          fullName = _this$state.fullName;\n      /**\r\n       * store all of everything thats being submitted,\r\n       * We do this by calling the ref method and passing\r\n       * in the destination we'd like them to be stored\r\n       */\n\n      var itemsRef = firebaseConf.database().ref('voters');\n\n      var uniqueID = function uniqueID() {\n        return 'LMC' + Math.random().toString(36).substr(2, 9).toUpperCase();\n      };\n\n      var item = {\n        fullName: _this.state.fullName,\n        category: _this.state.category,\n        section: _this.state.section,\n        teacher: _this.state.teacher,\n        schoolId: _this.state.schoolId,\n        status: 'Not voted',\n        id: uniqueID()\n      };\n\n      _this.setState({\n        uniqueIdentity: item.id,\n        fullName: item.fullName\n      });\n      /**\r\n       * similar to the Array.push method,\r\n       * this sends a copy of our object so\r\n       * that it can be stored in Firebase.\r\n       */\n\n\n      var filteredSchoolId = _this.state.fetchedSchoolId.find(function (id) {\n        return _this.state.schoolId === id.schoolId;\n      });\n\n      var usedSchoolId = _this.state.votersData.find(function (id) {\n        return _this.state.schoolId === id.voterSchoolId;\n      });\n\n      if (!filteredSchoolId) {\n        _this.showAlert('danger', 'The school Id you used was not registered by this school, Please Contact the administrator.');\n\n        _this.setState({\n          isLoading: false\n        });\n      } else if (usedSchoolId) {\n        _this.showAlert('danger', 'The school Id you entered has been used by another person to register. Please contact the administrator if it was not you.');\n\n        _this.setState({\n          isLoading: false\n        });\n      } else {\n        itemsRef.push(item).then(function () {\n          _this.sendFeedback(\"E-Voting\", \"raheem.azeezat@venturegardengroup.com\", \"Ade\", \"You have successflly registered. Your voter ID is xxxxxx.\");\n\n          _this.setState({\n            isLoading: false\n          });\n\n          _this.props.history.push({\n            pathname: '/successful-voter',\n            state: {\n              uniqueId: _this.state.uniqueIdentity,\n              fullName: fullName\n            }\n          });\n        });\n      }\n    };\n\n    _this.sendFeedback = function (senderName, receiverEmail, receiverName, feedback) {\n      var template_params = {\n        \"receiverEmail\": receiverEmail,\n        \"reply_to\": \"evoting@evoting.com.ng\",\n        \"receiverName\": receiverName,\n        \"senderName\": senderName,\n        \"feedback\": feedback\n      };\n      var service_id = \"default_service\";\n      var template_id = \"template_KmBJEuEZ\";\n      emailjs.send(service_id, template_id, template_params).then(function (res) {\n        _this.setState({\n          formEmailSent: true\n        });\n      }) // Handle errors here however you like, or use a React error boundary\n      .catch(function (err) {\n        return console.error('Failed to send feedback. Error: ', err);\n      });\n    };\n\n    _this.state = {\n      fullName: '',\n      section: '',\n      teacher: '',\n      category: '',\n      uniqueIdentity: '',\n      schoolId: '',\n      votersData: [],\n      fetchedSchoolId: [],\n      isLoading: false\n    };\n    return _this;\n  }\n\n  _createClass(FormExampleFieldControl, [{\n    key: \"showAlert\",\n    value: function showAlert(type, message) {\n      var _this2 = this;\n\n      this.setState({\n        alert: true,\n        alertData: {\n          type: type,\n          message: message\n        }\n      });\n      setTimeout(function () {\n        _this2.setState({\n          alert: false\n        });\n      }, 8000);\n    }\n  }, {\n    key: \"componentWillMount\",\n    value: function componentWillMount() {\n      var _this3 = this;\n\n      firebaseConf.database().ref('school').on('value', function (snapshot) {\n        var fetchedSchoolId = [];\n        snapshot.forEach(function (data) {\n          var fetchedSchoolIdNew = {\n            schoolId: data.key\n          };\n          fetchedSchoolId.push(fetchedSchoolIdNew);\n\n          _this3.setState({\n            fetchedSchoolId: fetchedSchoolId\n          });\n        });\n      }); //fetching voters school id to be able to see if they have registered before\n\n      firebaseConf.database().ref('voters').on('value', function (snapshot) {\n        var votersData = [];\n        snapshot.forEach(function (data) {\n          var votersDataNew = {\n            voterSchoolId: data.val().schoolId\n          };\n          votersData.push(votersDataNew);\n\n          _this3.setState({\n            votersData: votersData\n          });\n        });\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$state2 = this.state,\n          fullName = _this$state2.fullName,\n          category = _this$state2.category,\n          teacher = _this$state2.teacher,\n          section = _this$state2.section,\n          isLoading = _this$state2.isLoading,\n          schoolId = _this$state2.schoolId;\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 187\n        },\n        __self: this\n      }, React.createElement(\"h1\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 188\n        },\n        __self: this\n      }, \"Register Voters\"), React.createElement(\"marquee\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 189\n        },\n        __self: this\n      }, \"Note:Fill form in \", React.createElement(\"strong\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 190\n        },\n        __self: this\n      }, \"Capital Letters\")), this.state.alert && React.createElement(\"div\", {\n        className: \"alert alert-\".concat(this.state.alertData.type),\n        role: \"alert\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 193\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"container\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 197\n        },\n        __self: this\n      }, this.state.alertData.message)), React.createElement(Form, {\n        onChange: this.handleChange,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 200\n        },\n        __self: this\n      }, React.createElement(Form.Group, {\n        widths: \"equal\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 201\n        },\n        __self: this\n      }, React.createElement(Form.Field, {\n        control: Input,\n        label: \"Full name\",\n        placeholder: \"Full name\",\n        name: \"fullName\",\n        value: fullName,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 202\n        },\n        __self: this\n      })), React.createElement(Form.Group, {\n        widths: \"equal\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 210\n        },\n        __self: this\n      }, React.createElement(Form.Field, {\n        control: Select,\n        label: \"Class/Category\",\n        options: options,\n        placeholder: \"Class/Category\",\n        name: \"category\",\n        onChange: this.handleOptionSelect,\n        value: category,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 211\n        },\n        __self: this\n      }), React.createElement(Form.Field, {\n        control: Input,\n        label: \"Section\",\n        placeholder: \"Section\",\n        name: \"section\",\n        value: section,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 220\n        },\n        __self: this\n      })), React.createElement(Form.Group, {\n        widths: \"equal\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 228\n        },\n        __self: this\n      }, React.createElement(Form.Field, {\n        control: Input,\n        label: \"Class Teacher\",\n        placeholder: \"Class Teacher(For only students)\",\n        name: \"teacher\",\n        value: teacher,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 229\n        },\n        __self: this\n      }), React.createElement(Form.Field, {\n        control: Input,\n        label: \"School ID\",\n        placeholder: \"School ID\",\n        name: \"schoolId\",\n        value: schoolId,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 236\n        },\n        __self: this\n      })), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 244\n        },\n        __self: this\n      }), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 245\n        },\n        __self: this\n      }), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 246\n        },\n        __self: this\n      }), React.createElement(Form.Field, {\n        control: Button,\n        type: \"submit\",\n        color: \"blue\",\n        loading: isLoading,\n        disabled: !fullName || !category || !schoolId,\n        onClick: this.handleSubmit,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 248\n        },\n        __self: this\n      }, \"Submit\")), React.createElement(Offline, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 259\n        },\n        __self: this\n      }, React.createElement(\"marquee\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 260\n        },\n        __self: this\n      }, \"You are currently offline,Connect and contimue the process\")));\n    }\n  }]);\n\n  return FormExampleFieldControl;\n}(Component);\n\nexport default withRouter(FormExampleFieldControl);","map":{"version":3,"sources":["C:\\Users\\raheem.azeezat\\Desktop\\e-voting\\src\\Register.js"],"names":["React","Component","Button","Form","Input","Select","withRouter","firebaseConf","Offline","emailjs","options","key","text","value","FormExampleFieldControl","handleChange","e","setState","target","name","handleOptionSelect","handleSubmit","preventDefault","isLoading","state","uniqueIdentity","fullName","itemsRef","database","ref","uniqueID","Math","random","toString","substr","toUpperCase","item","category","section","teacher","schoolId","status","id","filteredSchoolId","fetchedSchoolId","find","usedSchoolId","votersData","voterSchoolId","showAlert","push","then","sendFeedback","props","history","pathname","uniqueId","senderName","receiverEmail","receiverName","feedback","template_params","service_id","template_id","send","res","formEmailSent","catch","err","console","error","type","message","alert","alertData","setTimeout","on","snapshot","forEach","data","fetchedSchoolIdNew","votersDataNew","val"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport { Button, Form, Input, Select } from 'semantic-ui-react';\r\nimport { withRouter } from 'react-router-dom';\r\nimport firebaseConf from './Components/Firebase';\r\nimport { Offline } from 'react-detect-offline';\r\nimport emailjs from 'emailjs-com'\r\n\r\nconst options = [\r\n  { key: '1', text: 'JSS1/YEAR 7', value: 'JSS1/YEAR 7' },\r\n  { key: '2', text: 'JSS2/YEAR 8', value: 'JSS2/YEAR 8' },\r\n  { key: '3', text: 'JSS3/YEAR 9', value: 'JSS3/YEAR 9' },\r\n  { key: '4', text: 'SS1/YEAR 10', value: 'SS1/YEAR 10' },\r\n  { key: '5', text: 'SS2/FORM 11', value: 'SS2/FORM 11' },\r\n  { key: '6', text: 'SS3/FORM 12', value: 'SS3/FORM 12' },\r\n  { key: 'TS', text: 'TEACHING STAFF', value: 'TEACHING STAFF' },\r\n  { key: 'NTS', text: 'NON-TEACHING STAFF', value: 'NON-TEACHING STAFF' },\r\n  { key: 'O', text: 'OTHERS', value: 'OTHERS' },\r\n];\r\n\r\nclass FormExampleFieldControl extends Component {\r\n  constructor() {\r\n    super();\r\n\r\n    this.state = {\r\n      fullName: '',\r\n      section: '',\r\n      teacher: '',\r\n      category: '',\r\n      uniqueIdentity: '',\r\n      schoolId: '',\r\n      votersData: [],\r\n      fetchedSchoolId: [],\r\n      isLoading: false,\r\n    };\r\n  }\r\n  showAlert(type, message) {\r\n    this.setState({\r\n      alert: true,\r\n      alertData: { type, message },\r\n    });\r\n    setTimeout(() => {\r\n      this.setState({ alert: false });\r\n    }, 8000);\r\n  }\r\n\r\n  handleChange = e => {\r\n    this.setState({ [e.target.name]: e.target.value });\r\n  };\r\n\r\n  handleOptionSelect = (e, { name, value }) => {\r\n    this.setState({ [name]: value });\r\n  };\r\n\r\n  handleSubmit = e => {\r\n    e.preventDefault();\r\n    this.setState({ isLoading: true });\r\n    const { uniqueIdentity, fullName } = this.state\r\n    /**\r\n     * store all of everything thats being submitted,\r\n     * We do this by calling the ref method and passing\r\n     * in the destination we'd like them to be stored\r\n     */\r\n\r\n    const itemsRef = firebaseConf.database().ref('voters');\r\n    const uniqueID = function () {\r\n      return (\r\n        'LMC' +\r\n        Math.random()\r\n          .toString(36)\r\n          .substr(2, 9)\r\n          .toUpperCase()\r\n      );\r\n    };\r\n    const item = {\r\n      fullName: this.state.fullName,\r\n      category: this.state.category,\r\n      section: this.state.section,\r\n      teacher: this.state.teacher,\r\n      schoolId: this.state.schoolId,\r\n      status: 'Not voted',\r\n      id: uniqueID(),\r\n    };\r\n    this.setState({ uniqueIdentity: item.id, fullName: item.fullName })\r\n    /**\r\n     * similar to the Array.push method,\r\n     * this sends a copy of our object so\r\n     * that it can be stored in Firebase.\r\n     */\r\n    let filteredSchoolId = this.state.fetchedSchoolId.find(id => {\r\n      return this.state.schoolId === id.schoolId;\r\n    });\r\n\r\n    let usedSchoolId = this.state.votersData.find(id => {\r\n      return this.state.schoolId === id.voterSchoolId;\r\n    });\r\n\r\n    if (!filteredSchoolId) {\r\n      this.showAlert(\r\n        'danger',\r\n        'The school Id you used was not registered by this school, Please Contact the administrator.'\r\n      );\r\n      this.setState({ isLoading: false });\r\n    } else if (usedSchoolId) {\r\n      this.showAlert(\r\n        'danger',\r\n        'The school Id you entered has been used by another person to register. Please contact the administrator if it was not you.'\r\n      );\r\n      this.setState({ isLoading: false });\r\n\r\n    } else {\r\n      itemsRef.push(item).then(() => {\r\n        this.sendFeedback(\"E-Voting\",\"raheem.azeezat@venturegardengroup.com\", \"Ade\",\"You have successflly registered. Your voter ID is xxxxxx.\")\r\n        this.setState({ isLoading: false });\r\n        this.props.history.push({\r\n          pathname: '/successful-voter',\r\n          state: {\r\n\r\n            uniqueId: this.state.uniqueIdentity,\r\n\r\n            fullName: fullName\r\n          }\r\n        });\r\n      });\r\n    }\r\n  };\r\n\r\n  sendFeedback = (senderName,receiverEmail, receiverName,feedback) => {\r\n\r\n    var template_params = {\r\n      \"receiverEmail\": receiverEmail,\r\n      \"reply_to\": \"evoting@evoting.com.ng\",\r\n      \"receiverName\": receiverName,\r\n      \"senderName\": senderName,\r\n      \"feedback\": feedback\r\n   }\r\n   \r\n   var service_id = \"default_service\";\r\n   var template_id = \"template_KmBJEuEZ\";\r\n   emailjs.send(service_id, template_id, template_params)\r\n     .then(res => {\r\n       this.setState({ formEmailSent: true })\r\n     })\r\n     // Handle errors here however you like, or use a React error boundary\r\n     .catch(err => console.error('Failed to send feedback. Error: ', err))\r\n  }\r\n\r\n  componentWillMount() {\r\n    firebaseConf\r\n      .database()\r\n      .ref('school')\r\n      .on('value', snapshot => {\r\n        const fetchedSchoolId = [];\r\n        snapshot.forEach(data => {\r\n          const fetchedSchoolIdNew = {\r\n            schoolId: data.key,\r\n          };\r\n          fetchedSchoolId.push(fetchedSchoolIdNew);\r\n          this.setState({ fetchedSchoolId });\r\n        });\r\n      });\r\n    //fetching voters school id to be able to see if they have registered before\r\n    firebaseConf\r\n      .database()\r\n      .ref('voters')\r\n      .on('value', snapshot => {\r\n        const votersData = [];\r\n        snapshot.forEach(data => {\r\n          const votersDataNew = {\r\n            voterSchoolId: data.val().schoolId,\r\n          };\r\n          votersData.push(votersDataNew);\r\n          this.setState({ votersData });\r\n        });\r\n      });\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      fullName,\r\n      category,\r\n      teacher,\r\n      section,\r\n      isLoading,\r\n      schoolId,\r\n    } = this.state;\r\n    return (\r\n      <div>\r\n        <h1>Register Voters</h1>\r\n        <marquee>\r\n          Note:Fill form in <strong>Capital Letters</strong>\r\n        </marquee>\r\n        {this.state.alert && (\r\n          <div\r\n            className={`alert alert-${this.state.alertData.type}`}\r\n            role=\"alert\"\r\n          >\r\n            <div className=\"container\">{this.state.alertData.message}</div>\r\n          </div>\r\n        )}\r\n        <Form onChange={this.handleChange}>\r\n          <Form.Group widths=\"equal\">\r\n            <Form.Field\r\n              control={Input}\r\n              label=\"Full name\"\r\n              placeholder=\"Full name\"\r\n              name=\"fullName\"\r\n              value={fullName}\r\n            />\r\n          </Form.Group>\r\n          <Form.Group widths=\"equal\">\r\n            <Form.Field\r\n              control={Select}\r\n              label=\"Class/Category\"\r\n              options={options}\r\n              placeholder=\"Class/Category\"\r\n              name=\"category\"\r\n              onChange={this.handleOptionSelect}\r\n              value={category}\r\n            />\r\n            <Form.Field\r\n              control={Input}\r\n              label=\"Section\"\r\n              placeholder=\"Section\"\r\n              name=\"section\"\r\n              value={section}\r\n            />\r\n          </Form.Group>\r\n          <Form.Group widths=\"equal\">\r\n            <Form.Field\r\n              control={Input}\r\n              label=\"Class Teacher\"\r\n              placeholder=\"Class Teacher(For only students)\"\r\n              name=\"teacher\"\r\n              value={teacher}\r\n            />\r\n            <Form.Field\r\n              control={Input}\r\n              label=\"School ID\"\r\n              placeholder=\"School ID\"\r\n              name=\"schoolId\"\r\n              value={schoolId}\r\n            />\r\n          </Form.Group>\r\n          <br />\r\n          <br />\r\n          <br />\r\n\r\n          <Form.Field\r\n            control={Button}\r\n            type=\"submit\"\r\n            color=\"blue\"\r\n            loading={isLoading}\r\n            disabled={!fullName || !category || !schoolId}\r\n            onClick={this.handleSubmit}\r\n          >\r\n            Submit\r\n          </Form.Field>\r\n        </Form>\r\n        <Offline>\r\n          <marquee>\r\n            You are currently offline,Connect and contimue the process\r\n          </marquee>\r\n        </Offline>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withRouter(FormExampleFieldControl);"]},"metadata":{},"sourceType":"module"}
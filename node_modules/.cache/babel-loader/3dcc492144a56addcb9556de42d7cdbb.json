{"ast":null,"code":"import _defineProperty from \"C:\\\\Users\\\\Faizal\\\\Downloads\\\\e-voting\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"C:\\\\Users\\\\Faizal\\\\Downloads\\\\e-voting\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\Faizal\\\\Downloads\\\\e-voting\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"C:\\\\Users\\\\Faizal\\\\Downloads\\\\e-voting\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"C:\\\\Users\\\\Faizal\\\\Downloads\\\\e-voting\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"C:\\\\Users\\\\Faizal\\\\Downloads\\\\e-voting\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"C:\\\\Users\\\\Faizal\\\\Downloads\\\\e-voting\\\\src\\\\Register.js\";\nimport React, { Component } from 'react';\nimport { Button, Form, Input, Select } from 'semantic-ui-react';\nimport { withRouter } from 'react-router-dom';\nimport firebaseConf from './Components/Firebase';\nimport { Offline } from 'react-detect-offline';\nimport * as emailjs from 'emailjs-com';\nvar options = [{\n  key: '1',\n  text: 'JSS1/YEAR 7',\n  value: 'JSS1/YEAR 7'\n}, {\n  key: '2',\n  text: 'JSS2/YEAR 8',\n  value: 'JSS2/YEAR 8'\n}, {\n  key: '3',\n  text: 'JSS3/YEAR 9',\n  value: 'JSS3/YEAR 9'\n}, {\n  key: '4',\n  text: 'SS1/YEAR 10',\n  value: 'SS1/YEAR 10'\n}, {\n  key: '5',\n  text: 'SS2/FORM 11',\n  value: 'SS2/FORM 11'\n}, {\n  key: '6',\n  text: 'SS3/FORM 12',\n  value: 'SS3/FORM 12'\n}, {\n  key: 'TS',\n  text: 'TEACHING STAFF',\n  value: 'TEACHING STAFF'\n}, {\n  key: 'NTS',\n  text: 'NON-TEACHING STAFF',\n  value: 'NON-TEACHING STAFF'\n}, {\n  key: 'O',\n  text: 'OTHERS',\n  value: 'OTHERS'\n}];\n\nvar FormExampleFieldControl =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(FormExampleFieldControl, _Component);\n\n  function FormExampleFieldControl() {\n    var _this;\n\n    _classCallCheck(this, FormExampleFieldControl);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(FormExampleFieldControl).call(this));\n\n    _this.handleChange = function (e) {\n      _this.setState(_defineProperty({}, e.target.name, e.target.value));\n    };\n\n    _this.handleOptionSelect = function (e, _ref) {\n      var name = _ref.name,\n          value = _ref.value;\n\n      _this.setState(_defineProperty({}, name, value));\n    };\n\n    _this.handleSubmit = function (e) {\n      e.preventDefault();\n\n      _this.setState({\n        isLoading: true\n      });\n\n      var _this$state = _this.state,\n          uniqueIdentity = _this$state.uniqueIdentity,\n          fullName = _this$state.fullName;\n      /**\r\n       * store all of everything thats being submitted,\r\n       * We do this by calling the ref method and passing\r\n       * in the destination we'd like them to be stored\r\n       */\n\n      var itemsRef = firebaseConf.database().ref('voters');\n\n      var uniqueID = function uniqueID() {\n        return 'LMC' + Math.random().toString(36).substr(2, 9).toUpperCase();\n      };\n\n      var item = {\n        fullName: _this.state.fullName,\n        category: _this.state.category,\n        section: _this.state.section,\n        teacher: _this.state.teacher,\n        schoolId: _this.state.schoolId,\n        email: _this.state.email,\n        status: 'Not voted',\n        id: uniqueID()\n      };\n\n      _this.setState({\n        uniqueIdentity: item.id,\n        fullName: item.fullName\n      });\n      /**\r\n       * similar to the Array.push method,\r\n       * this sends a copy of our object so\r\n       * that it can be stored in Firebase.\r\n       */\n\n\n      var filteredSchoolId = _this.state.fetchedSchoolId.find(function (id) {\n        return _this.state.schoolId === id.schoolId;\n      });\n\n      var usedSchoolId = _this.state.votersData.find(function (id) {\n        return _this.state.schoolId === id.voterSchoolId;\n      });\n\n      if (!filteredSchoolId) {\n        _this.showAlert('danger', 'The school Id you used was not registered by this school, Please Contact the administrator.');\n\n        _this.setState({\n          isLoading: false\n        });\n      } else if (usedSchoolId) {\n        _this.showAlert('danger', 'The school Id you entered has been used by another person to register. Please contact the administrator if it was not you.');\n\n        _this.setState({\n          isLoading: false\n        });\n      } else {\n        itemsRef.push(item).then(function () {\n          _this.sendFeedback(\"E-Voting\", \"\".concat(_this.state.fullName), \"\".concat(_this.state.email), \"You have successflly registered. Your voter ID is \".concat(_this.state.uniqueIdentity, \".\"));\n\n          _this.setState({\n            isLoading: false\n          });\n\n          _this.props.history.push({\n            pathname: '/successful-voter',\n            state: {\n              uniqueId: _this.state.uniqueIdentity,\n              fullName: fullName\n            }\n          });\n        });\n      }\n    };\n\n    _this.sendFeedback = function (senderName, receiverName, receiverEmail, feedback) {\n      var template_params = {\n        \"receiverEmail\": receiverEmail,\n        \"reply_to\": \"evoting@evoting.com.ng\",\n        \"receiverName\": receiverName,\n        \"senderName\": senderName,\n        \"feedback\": feedback\n      };\n      var service_id = \"default_service\";\n      var template_id = \"voterRegistration\";\n      var user_id = \"user_0BXEej2yQcLmlDlTI6wdg\";\n      emailjs.init(user_id);\n      emailjs.send(service_id, template_id, template_params, user_id).then(function (res) {\n        _this.setState({\n          formEmailSent: true\n        });\n      }) // Handle errors here however you like, or use a React error boundary\n      .catch(function (err) {\n        return console.error('Failed to send feedback. Error: ', err);\n      });\n    };\n\n    _this.state = {\n      fullName: '',\n      section: '',\n      teacher: '',\n      category: '',\n      uniqueIdentity: '',\n      schoolId: '',\n      email: '',\n      votersData: [],\n      fetchedSchoolId: [],\n      isLoading: false\n    };\n    return _this;\n  }\n\n  _createClass(FormExampleFieldControl, [{\n    key: \"showAlert\",\n    value: function showAlert(type, message) {\n      var _this2 = this;\n\n      this.setState({\n        alert: true,\n        alertData: {\n          type: type,\n          message: message\n        }\n      });\n      setTimeout(function () {\n        _this2.setState({\n          alert: false\n        });\n      }, 8000);\n    }\n  }, {\n    key: \"componentWillMount\",\n    value: function componentWillMount() {\n      var _this3 = this;\n\n      firebaseConf.database().ref('school').on('value', function (snapshot) {\n        var fetchedSchoolId = [];\n        snapshot.forEach(function (data) {\n          var fetchedSchoolIdNew = {\n            schoolId: data.key\n          };\n          fetchedSchoolId.push(fetchedSchoolIdNew);\n\n          _this3.setState({\n            fetchedSchoolId: fetchedSchoolId\n          });\n        });\n      }); //fetching voters school id to be able to see if they have registered before\n\n      firebaseConf.database().ref('voters').on('value', function (snapshot) {\n        var votersData = [];\n        snapshot.forEach(function (data) {\n          var votersDataNew = {\n            voterSchoolId: data.val().schoolId\n          };\n          votersData.push(votersDataNew);\n\n          _this3.setState({\n            votersData: votersData\n          });\n        });\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _React$createElement;\n\n      var _this$state2 = this.state,\n          fullName = _this$state2.fullName,\n          category = _this$state2.category,\n          teacher = _this$state2.teacher,\n          section = _this$state2.section,\n          isLoading = _this$state2.isLoading,\n          schoolId = _this$state2.schoolId,\n          email = _this$state2.email;\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 193\n        },\n        __self: this\n      }, React.createElement(\"h1\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 194\n        },\n        __self: this\n      }, \"Register Voters\"), React.createElement(\"marquee\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195\n        },\n        __self: this\n      }, \"Note:Fill form in \", React.createElement(\"strong\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 196\n        },\n        __self: this\n      }, \"Capital Letters\")), this.state.alert && React.createElement(\"div\", {\n        className: \"alert alert-\".concat(this.state.alertData.type),\n        role: \"alert\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 199\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"container\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 203\n        },\n        __self: this\n      }, this.state.alertData.message)), React.createElement(Form, {\n        onChange: this.handleChange,\n        onSubmit: this.handleSubmit,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 206\n        },\n        __self: this\n      }, React.createElement(Form.Group, {\n        widths: \"equal\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 207\n        },\n        __self: this\n      }, React.createElement(Form.Field, {\n        control: Input,\n        label: \"Full name\",\n        placeholder: \"Full name\",\n        name: \"fullName\",\n        value: fullName,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 208\n        },\n        __self: this\n      }), React.createElement(Form.Field, {\n        control: Input,\n        label: \"Email\",\n        placeholder: \"Email address\",\n        type: \"email\",\n        name: \"email\",\n        value: email,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 215\n        },\n        __self: this\n      })), React.createElement(Form.Group, {\n        widths: \"equal\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 224\n        },\n        __self: this\n      }, React.createElement(Form.Field, {\n        control: Select,\n        label: \"Class/Category\",\n        options: options,\n        placeholder: \"Class/Category\",\n        name: \"category\",\n        onChange: this.handleOptionSelect,\n        value: category,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 225\n        },\n        __self: this\n      }), React.createElement(Form.Field, {\n        control: Input,\n        label: \"Section\",\n        placeholder: \"Section\",\n        name: \"section\",\n        value: section,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 234\n        },\n        __self: this\n      })), React.createElement(Form.Group, {\n        widths: \"equal\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 242\n        },\n        __self: this\n      }, React.createElement(Form.Field, {\n        control: Input,\n        label: \"Class Teacher\",\n        placeholder: \"Class Teacher(For only students)\",\n        name: \"teacher\",\n        value: teacher,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 243\n        },\n        __self: this\n      }), React.createElement(Form.Field, {\n        control: Input,\n        label: \"School ID\",\n        placeholder: \"School ID\",\n        name: \"schoolId\",\n        value: schoolId,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 250\n        },\n        __self: this\n      })), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 258\n        },\n        __self: this\n      }), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 259\n        },\n        __self: this\n      }), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 260\n        },\n        __self: this\n      }), React.createElement(Form.Field, (_React$createElement = {\n        control: Button,\n        type: \"submit\",\n        color: \"blue\",\n        loading: isLoading,\n        disabled: !fullName || !category || !schoolId\n      }, _defineProperty(_React$createElement, \"type\", \"submit\"), _defineProperty(_React$createElement, \"__source\", {\n        fileName: _jsxFileName,\n        lineNumber: 262\n      }), _defineProperty(_React$createElement, \"__self\", this), _React$createElement), \"Submit\")), React.createElement(Offline, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 273\n        },\n        __self: this\n      }, React.createElement(\"marquee\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 274\n        },\n        __self: this\n      }, \"You are currently offline,Connect and contimue the process\")));\n    }\n  }]);\n\n  return FormExampleFieldControl;\n}(Component);\n\nexport default withRouter(FormExampleFieldControl);","map":{"version":3,"sources":["C:\\Users\\Faizal\\Downloads\\e-voting\\src\\Register.js"],"names":["React","Component","Button","Form","Input","Select","withRouter","firebaseConf","Offline","emailjs","options","key","text","value","FormExampleFieldControl","handleChange","e","setState","target","name","handleOptionSelect","handleSubmit","preventDefault","isLoading","state","uniqueIdentity","fullName","itemsRef","database","ref","uniqueID","Math","random","toString","substr","toUpperCase","item","category","section","teacher","schoolId","email","status","id","filteredSchoolId","fetchedSchoolId","find","usedSchoolId","votersData","voterSchoolId","showAlert","push","then","sendFeedback","props","history","pathname","uniqueId","senderName","receiverName","receiverEmail","feedback","template_params","service_id","template_id","user_id","init","send","res","formEmailSent","catch","err","console","error","type","message","alert","alertData","setTimeout","on","snapshot","forEach","data","fetchedSchoolIdNew","votersDataNew","val"],"mappings":";;;;;;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,SAASC,MAAT,EAAiBC,IAAjB,EAAuBC,KAAvB,EAA8BC,MAA9B,QAA4C,mBAA5C;AACA,SAASC,UAAT,QAA2B,kBAA3B;AACA,OAAOC,YAAP,MAAyB,uBAAzB;AACA,SAASC,OAAT,QAAwB,sBAAxB;AACA,OAAO,KAAKC,OAAZ,MAAyB,aAAzB;AAEA,IAAMC,OAAO,GAAG,CACd;AAAEC,EAAAA,GAAG,EAAE,GAAP;AAAYC,EAAAA,IAAI,EAAE,aAAlB;AAAiCC,EAAAA,KAAK,EAAE;AAAxC,CADc,EAEd;AAAEF,EAAAA,GAAG,EAAE,GAAP;AAAYC,EAAAA,IAAI,EAAE,aAAlB;AAAiCC,EAAAA,KAAK,EAAE;AAAxC,CAFc,EAGd;AAAEF,EAAAA,GAAG,EAAE,GAAP;AAAYC,EAAAA,IAAI,EAAE,aAAlB;AAAiCC,EAAAA,KAAK,EAAE;AAAxC,CAHc,EAId;AAAEF,EAAAA,GAAG,EAAE,GAAP;AAAYC,EAAAA,IAAI,EAAE,aAAlB;AAAiCC,EAAAA,KAAK,EAAE;AAAxC,CAJc,EAKd;AAAEF,EAAAA,GAAG,EAAE,GAAP;AAAYC,EAAAA,IAAI,EAAE,aAAlB;AAAiCC,EAAAA,KAAK,EAAE;AAAxC,CALc,EAMd;AAAEF,EAAAA,GAAG,EAAE,GAAP;AAAYC,EAAAA,IAAI,EAAE,aAAlB;AAAiCC,EAAAA,KAAK,EAAE;AAAxC,CANc,EAOd;AAAEF,EAAAA,GAAG,EAAE,IAAP;AAAaC,EAAAA,IAAI,EAAE,gBAAnB;AAAqCC,EAAAA,KAAK,EAAE;AAA5C,CAPc,EAQd;AAAEF,EAAAA,GAAG,EAAE,KAAP;AAAcC,EAAAA,IAAI,EAAE,oBAApB;AAA0CC,EAAAA,KAAK,EAAE;AAAjD,CARc,EASd;AAAEF,EAAAA,GAAG,EAAE,GAAP;AAAYC,EAAAA,IAAI,EAAE,QAAlB;AAA4BC,EAAAA,KAAK,EAAE;AAAnC,CATc,CAAhB;;IAYMC,uB;;;;;AACJ,qCAAc;AAAA;;AAAA;;AACZ;;AADY,UA0BdC,YA1Bc,GA0BC,UAAAC,CAAC,EAAI;AAClB,YAAKC,QAAL,qBAAiBD,CAAC,CAACE,MAAF,CAASC,IAA1B,EAAiCH,CAAC,CAACE,MAAF,CAASL,KAA1C;AACD,KA5Ba;;AAAA,UA8BdO,kBA9Bc,GA8BO,UAACJ,CAAD,QAAwB;AAAA,UAAlBG,IAAkB,QAAlBA,IAAkB;AAAA,UAAZN,KAAY,QAAZA,KAAY;;AAC3C,YAAKI,QAAL,qBAAiBE,IAAjB,EAAwBN,KAAxB;AACD,KAhCa;;AAAA,UAkCdQ,YAlCc,GAkCC,UAAAL,CAAC,EAAI;AAClBA,MAAAA,CAAC,CAACM,cAAF;;AACA,YAAKL,QAAL,CAAc;AAAEM,QAAAA,SAAS,EAAE;AAAb,OAAd;;AAFkB,wBAGmB,MAAKC,KAHxB;AAAA,UAGVC,cAHU,eAGVA,cAHU;AAAA,UAGMC,QAHN,eAGMA,QAHN;AAIlB;;;;;;AAMA,UAAMC,QAAQ,GAAGpB,YAAY,CAACqB,QAAb,GAAwBC,GAAxB,CAA4B,QAA5B,CAAjB;;AACA,UAAMC,QAAQ,GAAG,SAAXA,QAAW,GAAY;AAC3B,eACE,QACAC,IAAI,CAACC,MAAL,GACGC,QADH,CACY,EADZ,EAEGC,MAFH,CAEU,CAFV,EAEa,CAFb,EAGGC,WAHH,EAFF;AAOD,OARD;;AASA,UAAMC,IAAI,GAAG;AACXV,QAAAA,QAAQ,EAAE,MAAKF,KAAL,CAAWE,QADV;AAEXW,QAAAA,QAAQ,EAAE,MAAKb,KAAL,CAAWa,QAFV;AAGXC,QAAAA,OAAO,EAAE,MAAKd,KAAL,CAAWc,OAHT;AAIXC,QAAAA,OAAO,EAAE,MAAKf,KAAL,CAAWe,OAJT;AAKXC,QAAAA,QAAQ,EAAE,MAAKhB,KAAL,CAAWgB,QALV;AAMXC,QAAAA,KAAK,EAAC,MAAKjB,KAAL,CAAWiB,KANN;AAOXC,QAAAA,MAAM,EAAE,WAPG;AAQXC,QAAAA,EAAE,EAAEb,QAAQ;AARD,OAAb;;AAUA,YAAKb,QAAL,CAAc;AAAEQ,QAAAA,cAAc,EAAEW,IAAI,CAACO,EAAvB;AAA2BjB,QAAAA,QAAQ,EAAEU,IAAI,CAACV;AAA1C,OAAd;AACA;;;;;;;AAKA,UAAIkB,gBAAgB,GAAG,MAAKpB,KAAL,CAAWqB,eAAX,CAA2BC,IAA3B,CAAgC,UAAAH,EAAE,EAAI;AAC3D,eAAO,MAAKnB,KAAL,CAAWgB,QAAX,KAAwBG,EAAE,CAACH,QAAlC;AACD,OAFsB,CAAvB;;AAIA,UAAIO,YAAY,GAAG,MAAKvB,KAAL,CAAWwB,UAAX,CAAsBF,IAAtB,CAA2B,UAAAH,EAAE,EAAI;AAClD,eAAO,MAAKnB,KAAL,CAAWgB,QAAX,KAAwBG,EAAE,CAACM,aAAlC;AACD,OAFkB,CAAnB;;AAIA,UAAI,CAACL,gBAAL,EAAuB;AACrB,cAAKM,SAAL,CACE,QADF,EAEE,6FAFF;;AAIA,cAAKjC,QAAL,CAAc;AAAEM,UAAAA,SAAS,EAAE;AAAb,SAAd;AACD,OAND,MAMO,IAAIwB,YAAJ,EAAkB;AACvB,cAAKG,SAAL,CACE,QADF,EAEE,4HAFF;;AAIA,cAAKjC,QAAL,CAAc;AAAEM,UAAAA,SAAS,EAAE;AAAb,SAAd;AAED,OAPM,MAOA;AACLI,QAAAA,QAAQ,CAACwB,IAAT,CAAcf,IAAd,EAAoBgB,IAApB,CAAyB,YAAM;AAC7B,gBAAKC,YAAL,CAAkB,UAAlB,YAAiC,MAAK7B,KAAL,CAAWE,QAA5C,aAA0D,MAAKF,KAAL,CAAWiB,KAArE,+DAAkI,MAAKjB,KAAL,CAAWC,cAA7I;;AACA,gBAAKR,QAAL,CAAc;AAAEM,YAAAA,SAAS,EAAE;AAAb,WAAd;;AACA,gBAAK+B,KAAL,CAAWC,OAAX,CAAmBJ,IAAnB,CAAwB;AACtBK,YAAAA,QAAQ,EAAE,mBADY;AAEtBhC,YAAAA,KAAK,EAAE;AAELiC,cAAAA,QAAQ,EAAE,MAAKjC,KAAL,CAAWC,cAFhB;AAILC,cAAAA,QAAQ,EAAEA;AAJL;AAFe,WAAxB;AASD,SAZD;AAaD;AACF,KA1Ga;;AAAA,UA4Gd2B,YA5Gc,GA4GC,UAACK,UAAD,EAAYC,YAAZ,EAAyBC,aAAzB,EAAuCC,QAAvC,EAAoD;AAEjE,UAAIC,eAAe,GAAG;AACpB,yBAAiBF,aADG;AAEpB,oBAAY,wBAFQ;AAGpB,wBAAgBD,YAHI;AAIpB,sBAAcD,UAJM;AAKpB,oBAAYG;AALQ,OAAtB;AAQD,UAAIE,UAAU,GAAG,iBAAjB;AACA,UAAIC,WAAW,GAAG,mBAAlB;AACA,UAAIC,OAAO,GAAE,4BAAb;AAEAxD,MAAAA,OAAO,CAACyD,IAAR,CAAaD,OAAb;AACAxD,MAAAA,OAAO,CAAC0D,IAAR,CAAaJ,UAAb,EAAyBC,WAAzB,EAAsCF,eAAtC,EAAsDG,OAAtD,EACGb,IADH,CACQ,UAAAgB,GAAG,EAAI;AACX,cAAKnD,QAAL,CAAc;AAAEoD,UAAAA,aAAa,EAAE;AAAjB,SAAd;AACD,OAHH,EAIE;AAJF,OAKGC,KALH,CAKS,UAAAC,GAAG;AAAA,eAAIC,OAAO,CAACC,KAAR,CAAc,kCAAd,EAAkDF,GAAlD,CAAJ;AAAA,OALZ;AAMA,KAjIa;;AAGZ,UAAK/C,KAAL,GAAa;AACXE,MAAAA,QAAQ,EAAE,EADC;AAEXY,MAAAA,OAAO,EAAE,EAFE;AAGXC,MAAAA,OAAO,EAAE,EAHE;AAIXF,MAAAA,QAAQ,EAAE,EAJC;AAKXZ,MAAAA,cAAc,EAAE,EALL;AAMXe,MAAAA,QAAQ,EAAE,EANC;AAOXC,MAAAA,KAAK,EAAC,EAPK;AAQXO,MAAAA,UAAU,EAAE,EARD;AASXH,MAAAA,eAAe,EAAE,EATN;AAUXtB,MAAAA,SAAS,EAAE;AAVA,KAAb;AAHY;AAeb;;;;8BACSmD,I,EAAMC,O,EAAS;AAAA;;AACvB,WAAK1D,QAAL,CAAc;AACZ2D,QAAAA,KAAK,EAAE,IADK;AAEZC,QAAAA,SAAS,EAAE;AAAEH,UAAAA,IAAI,EAAJA,IAAF;AAAQC,UAAAA,OAAO,EAAPA;AAAR;AAFC,OAAd;AAIAG,MAAAA,UAAU,CAAC,YAAM;AACf,QAAA,MAAI,CAAC7D,QAAL,CAAc;AAAE2D,UAAAA,KAAK,EAAE;AAAT,SAAd;AACD,OAFS,EAEP,IAFO,CAAV;AAGD;;;yCA2GoB;AAAA;;AACnBrE,MAAAA,YAAY,CACTqB,QADH,GAEGC,GAFH,CAEO,QAFP,EAGGkD,EAHH,CAGM,OAHN,EAGe,UAAAC,QAAQ,EAAI;AACvB,YAAMnC,eAAe,GAAG,EAAxB;AACAmC,QAAAA,QAAQ,CAACC,OAAT,CAAiB,UAAAC,IAAI,EAAI;AACvB,cAAMC,kBAAkB,GAAG;AACzB3C,YAAAA,QAAQ,EAAE0C,IAAI,CAACvE;AADU,WAA3B;AAGAkC,UAAAA,eAAe,CAACM,IAAhB,CAAqBgC,kBAArB;;AACA,UAAA,MAAI,CAAClE,QAAL,CAAc;AAAE4B,YAAAA,eAAe,EAAfA;AAAF,WAAd;AACD,SAND;AAOD,OAZH,EADmB,CAcnB;;AACAtC,MAAAA,YAAY,CACTqB,QADH,GAEGC,GAFH,CAEO,QAFP,EAGGkD,EAHH,CAGM,OAHN,EAGe,UAAAC,QAAQ,EAAI;AACvB,YAAMhC,UAAU,GAAG,EAAnB;AACAgC,QAAAA,QAAQ,CAACC,OAAT,CAAiB,UAAAC,IAAI,EAAI;AACvB,cAAME,aAAa,GAAG;AACpBnC,YAAAA,aAAa,EAAEiC,IAAI,CAACG,GAAL,GAAW7C;AADN,WAAtB;AAGAQ,UAAAA,UAAU,CAACG,IAAX,CAAgBiC,aAAhB;;AACA,UAAA,MAAI,CAACnE,QAAL,CAAc;AAAE+B,YAAAA,UAAU,EAAVA;AAAF,WAAd;AACD,SAND;AAOD,OAZH;AAaD;;;6BAEQ;AAAA;;AAAA,yBASH,KAAKxB,KATF;AAAA,UAELE,QAFK,gBAELA,QAFK;AAAA,UAGLW,QAHK,gBAGLA,QAHK;AAAA,UAILE,OAJK,gBAILA,OAJK;AAAA,UAKLD,OALK,gBAKLA,OALK;AAAA,UAMLf,SANK,gBAMLA,SANK;AAAA,UAOLiB,QAPK,gBAOLA,QAPK;AAAA,UAQLC,KARK,gBAQLA,KARK;AAUP,aACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2BADF,EAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+BACoB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2BADpB,CAFF,EAKG,KAAKjB,KAAL,CAAWoD,KAAX,IACC;AACE,QAAA,SAAS,wBAAiB,KAAKpD,KAAL,CAAWqD,SAAX,CAAqBH,IAAtC,CADX;AAEE,QAAA,IAAI,EAAC,OAFP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAIE;AAAK,QAAA,SAAS,EAAC,WAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAA4B,KAAKlD,KAAL,CAAWqD,SAAX,CAAqBF,OAAjD,CAJF,CANJ,EAaE,oBAAC,IAAD;AAAM,QAAA,QAAQ,EAAE,KAAK5D,YAArB;AAAmC,QAAA,QAAQ,EAAE,KAAKM,YAAlD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE,oBAAC,IAAD,CAAM,KAAN;AAAY,QAAA,MAAM,EAAC,OAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE,oBAAC,IAAD,CAAM,KAAN;AACE,QAAA,OAAO,EAAEjB,KADX;AAEE,QAAA,KAAK,EAAC,WAFR;AAGE,QAAA,WAAW,EAAC,WAHd;AAIE,QAAA,IAAI,EAAC,UAJP;AAKE,QAAA,KAAK,EAAEsB,QALT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,EAQG,oBAAC,IAAD,CAAM,KAAN;AACC,QAAA,OAAO,EAAEtB,KADV;AAEC,QAAA,KAAK,EAAC,OAFP;AAGC,QAAA,WAAW,EAAC,eAHb;AAIC,QAAA,IAAI,EAAC,OAJN;AAKC,QAAA,IAAI,EAAC,OALN;AAMC,QAAA,KAAK,EAAEqC,KANR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QARH,CADF,EAkBE,oBAAC,IAAD,CAAM,KAAN;AAAY,QAAA,MAAM,EAAC,OAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE,oBAAC,IAAD,CAAM,KAAN;AACE,QAAA,OAAO,EAAEpC,MADX;AAEE,QAAA,KAAK,EAAC,gBAFR;AAGE,QAAA,OAAO,EAAEK,OAHX;AAIE,QAAA,WAAW,EAAC,gBAJd;AAKE,QAAA,IAAI,EAAC,UALP;AAME,QAAA,QAAQ,EAAE,KAAKU,kBANjB;AAOE,QAAA,KAAK,EAAEiB,QAPT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,EAUE,oBAAC,IAAD,CAAM,KAAN;AACE,QAAA,OAAO,EAAEjC,KADX;AAEE,QAAA,KAAK,EAAC,SAFR;AAGE,QAAA,WAAW,EAAC,SAHd;AAIE,QAAA,IAAI,EAAC,SAJP;AAKE,QAAA,KAAK,EAAEkC,OALT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAVF,CAlBF,EAoCE,oBAAC,IAAD,CAAM,KAAN;AAAY,QAAA,MAAM,EAAC,OAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE,oBAAC,IAAD,CAAM,KAAN;AACE,QAAA,OAAO,EAAElC,KADX;AAEE,QAAA,KAAK,EAAC,eAFR;AAGE,QAAA,WAAW,EAAC,kCAHd;AAIE,QAAA,IAAI,EAAC,SAJP;AAKE,QAAA,KAAK,EAAEmC,OALT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,EAQE,oBAAC,IAAD,CAAM,KAAN;AACE,QAAA,OAAO,EAAEnC,KADX;AAEE,QAAA,KAAK,EAAC,WAFR;AAGE,QAAA,WAAW,EAAC,WAHd;AAIE,QAAA,IAAI,EAAC,UAJP;AAKE,QAAA,KAAK,EAAEoC,QALT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QARF,CApCF,EAoDE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QApDF,EAqDE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QArDF,EAsDE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAtDF,EAwDE,oBAAC,IAAD,CAAM,KAAN;AACE,QAAA,OAAO,EAAEtC,MADX;AAEE,QAAA,IAAI,EAAC,QAFP;AAGE,QAAA,KAAK,EAAC,MAHR;AAIE,QAAA,OAAO,EAAEqB,SAJX;AAKE,QAAA,QAAQ,EAAE,CAACG,QAAD,IAAa,CAACW,QAAd,IAA0B,CAACG;AALvC,uDAMO,QANP;AAAA;AAAA;AAAA,iGAxDF,CAbF,EAgFE,oBAAC,OAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sEADF,CAhFF,CADF;AAwFD;;;;EApQmCvC,S;;AAuQtC,eAAeK,UAAU,CAACQ,uBAAD,CAAzB","sourcesContent":["import React, { Component } from 'react';\r\nimport { Button, Form, Input, Select } from 'semantic-ui-react';\r\nimport { withRouter } from 'react-router-dom';\r\nimport firebaseConf from './Components/Firebase';\r\nimport { Offline } from 'react-detect-offline';\r\nimport * as emailjs from 'emailjs-com'\r\n\r\nconst options = [\r\n  { key: '1', text: 'JSS1/YEAR 7', value: 'JSS1/YEAR 7' },\r\n  { key: '2', text: 'JSS2/YEAR 8', value: 'JSS2/YEAR 8' },\r\n  { key: '3', text: 'JSS3/YEAR 9', value: 'JSS3/YEAR 9' },\r\n  { key: '4', text: 'SS1/YEAR 10', value: 'SS1/YEAR 10' },\r\n  { key: '5', text: 'SS2/FORM 11', value: 'SS2/FORM 11' },\r\n  { key: '6', text: 'SS3/FORM 12', value: 'SS3/FORM 12' },\r\n  { key: 'TS', text: 'TEACHING STAFF', value: 'TEACHING STAFF' },\r\n  { key: 'NTS', text: 'NON-TEACHING STAFF', value: 'NON-TEACHING STAFF' },\r\n  { key: 'O', text: 'OTHERS', value: 'OTHERS' },\r\n];\r\n\r\nclass FormExampleFieldControl extends Component {\r\n  constructor() {\r\n    super();\r\n\r\n    this.state = {\r\n      fullName: '',\r\n      section: '',\r\n      teacher: '',\r\n      category: '',\r\n      uniqueIdentity: '',\r\n      schoolId: '',\r\n      email:'',\r\n      votersData: [],\r\n      fetchedSchoolId: [],\r\n      isLoading: false,\r\n    };\r\n  }\r\n  showAlert(type, message) {\r\n    this.setState({\r\n      alert: true,\r\n      alertData: { type, message },\r\n    });\r\n    setTimeout(() => {\r\n      this.setState({ alert: false });\r\n    }, 8000);\r\n  }\r\n\r\n  handleChange = e => {\r\n    this.setState({ [e.target.name]: e.target.value });\r\n  };\r\n\r\n  handleOptionSelect = (e, { name, value }) => {\r\n    this.setState({ [name]: value });\r\n  };\r\n\r\n  handleSubmit = e => {\r\n    e.preventDefault();\r\n    this.setState({ isLoading: true });\r\n    const { uniqueIdentity, fullName } = this.state\r\n    /**\r\n     * store all of everything thats being submitted,\r\n     * We do this by calling the ref method and passing\r\n     * in the destination we'd like them to be stored\r\n     */\r\n\r\n    const itemsRef = firebaseConf.database().ref('voters');\r\n    const uniqueID = function () {\r\n      return (\r\n        'LMC' +\r\n        Math.random()\r\n          .toString(36)\r\n          .substr(2, 9)\r\n          .toUpperCase()\r\n      );\r\n    };\r\n    const item = {\r\n      fullName: this.state.fullName,\r\n      category: this.state.category,\r\n      section: this.state.section,\r\n      teacher: this.state.teacher,\r\n      schoolId: this.state.schoolId,\r\n      email:this.state.email,\r\n      status: 'Not voted',\r\n      id: uniqueID(),\r\n    };\r\n    this.setState({ uniqueIdentity: item.id, fullName: item.fullName })\r\n    /**\r\n     * similar to the Array.push method,\r\n     * this sends a copy of our object so\r\n     * that it can be stored in Firebase.\r\n     */\r\n    let filteredSchoolId = this.state.fetchedSchoolId.find(id => {\r\n      return this.state.schoolId === id.schoolId;\r\n    });\r\n\r\n    let usedSchoolId = this.state.votersData.find(id => {\r\n      return this.state.schoolId === id.voterSchoolId;\r\n    });\r\n\r\n    if (!filteredSchoolId) {\r\n      this.showAlert(\r\n        'danger',\r\n        'The school Id you used was not registered by this school, Please Contact the administrator.'\r\n      );\r\n      this.setState({ isLoading: false });\r\n    } else if (usedSchoolId) {\r\n      this.showAlert(\r\n        'danger',\r\n        'The school Id you entered has been used by another person to register. Please contact the administrator if it was not you.'\r\n      );\r\n      this.setState({ isLoading: false });\r\n\r\n    } else {\r\n      itemsRef.push(item).then(() => {\r\n        this.sendFeedback(\"E-Voting\", `${this.state.fullName}`,`${this.state.email}`,`You have successflly registered. Your voter ID is ${this.state.uniqueIdentity}.`)\r\n        this.setState({ isLoading: false });\r\n        this.props.history.push({\r\n          pathname: '/successful-voter',\r\n          state: {\r\n\r\n            uniqueId: this.state.uniqueIdentity,\r\n\r\n            fullName: fullName\r\n          }\r\n        });\r\n      });\r\n    }\r\n  };\r\n\r\n  sendFeedback = (senderName,receiverName,receiverEmail,feedback) => {\r\n\r\n    var template_params = {\r\n      \"receiverEmail\": receiverEmail,\r\n      \"reply_to\": \"evoting@evoting.com.ng\",\r\n      \"receiverName\": receiverName,\r\n      \"senderName\": senderName,\r\n      \"feedback\": feedback\r\n   }\r\n   \r\n   var service_id = \"default_service\";\r\n   var template_id = \"voterRegistration\";\r\n   var user_id =\"user_0BXEej2yQcLmlDlTI6wdg\"\r\n   \r\n   emailjs.init(user_id);\r\n   emailjs.send(service_id, template_id, template_params,user_id)\r\n     .then(res => {\r\n       this.setState({ formEmailSent: true })\r\n     })\r\n     // Handle errors here however you like, or use a React error boundary\r\n     .catch(err => console.error('Failed to send feedback. Error: ', err))\r\n  }\r\n\r\n  componentWillMount() {\r\n    firebaseConf\r\n      .database()\r\n      .ref('school')\r\n      .on('value', snapshot => {\r\n        const fetchedSchoolId = [];\r\n        snapshot.forEach(data => {\r\n          const fetchedSchoolIdNew = {\r\n            schoolId: data.key,\r\n          };\r\n          fetchedSchoolId.push(fetchedSchoolIdNew);\r\n          this.setState({ fetchedSchoolId });\r\n        });\r\n      });\r\n    //fetching voters school id to be able to see if they have registered before\r\n    firebaseConf\r\n      .database()\r\n      .ref('voters')\r\n      .on('value', snapshot => {\r\n        const votersData = [];\r\n        snapshot.forEach(data => {\r\n          const votersDataNew = {\r\n            voterSchoolId: data.val().schoolId,\r\n          };\r\n          votersData.push(votersDataNew);\r\n          this.setState({ votersData });\r\n        });\r\n      });\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      fullName,\r\n      category,\r\n      teacher,\r\n      section,\r\n      isLoading,\r\n      schoolId,\r\n      email\r\n    } = this.state;\r\n    return (\r\n      <div>\r\n        <h1>Register Voters</h1>\r\n        <marquee>\r\n          Note:Fill form in <strong>Capital Letters</strong>\r\n        </marquee>\r\n        {this.state.alert && (\r\n          <div\r\n            className={`alert alert-${this.state.alertData.type}`}\r\n            role=\"alert\"\r\n          >\r\n            <div className=\"container\">{this.state.alertData.message}</div>\r\n          </div>\r\n        )}\r\n        <Form onChange={this.handleChange} onSubmit={this.handleSubmit}>\r\n          <Form.Group widths=\"equal\">\r\n            <Form.Field\r\n              control={Input}\r\n              label=\"Full name\"\r\n              placeholder=\"Full name\"\r\n              name=\"fullName\"\r\n              value={fullName}\r\n            />\r\n             <Form.Field\r\n              control={Input}\r\n              label=\"Email\"\r\n              placeholder=\"Email address\"\r\n              type='email'\r\n              name=\"email\"\r\n              value={email}\r\n            />\r\n          </Form.Group>\r\n          <Form.Group widths=\"equal\">\r\n            <Form.Field\r\n              control={Select}\r\n              label=\"Class/Category\"\r\n              options={options}\r\n              placeholder=\"Class/Category\"\r\n              name=\"category\"\r\n              onChange={this.handleOptionSelect}\r\n              value={category}\r\n            />\r\n            <Form.Field\r\n              control={Input}\r\n              label=\"Section\"\r\n              placeholder=\"Section\"\r\n              name=\"section\"\r\n              value={section}\r\n            />\r\n          </Form.Group>\r\n          <Form.Group widths=\"equal\">\r\n            <Form.Field\r\n              control={Input}\r\n              label=\"Class Teacher\"\r\n              placeholder=\"Class Teacher(For only students)\"\r\n              name=\"teacher\"\r\n              value={teacher}\r\n            />\r\n            <Form.Field\r\n              control={Input}\r\n              label=\"School ID\"\r\n              placeholder=\"School ID\"\r\n              name=\"schoolId\"\r\n              value={schoolId}\r\n            />\r\n          </Form.Group>\r\n          <br />\r\n          <br />\r\n          <br />\r\n\r\n          <Form.Field\r\n            control={Button}\r\n            type=\"submit\"\r\n            color=\"blue\"\r\n            loading={isLoading}\r\n            disabled={!fullName || !category || !schoolId}\r\n            type=\"submit\"\r\n          >\r\n            Submit\r\n          </Form.Field>\r\n        </Form>\r\n        <Offline>\r\n          <marquee>\r\n            You are currently offline,Connect and contimue the process\r\n          </marquee>\r\n        </Offline>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withRouter(FormExampleFieldControl);"]},"metadata":{},"sourceType":"module"}